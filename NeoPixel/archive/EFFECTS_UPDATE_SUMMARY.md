# ğŸ¨ LED æ•ˆæœæ›´æ–°ç¸½çµ

## æ›´æ–°æ—¥æœŸ
2025-11-23

## ğŸ“Š æ›´æ–°æ¦‚è¦½

### æ–°å¢æ•ˆæœæ•¸é‡
- **åŸæœ‰æ•ˆæœ**: 4 å€‹
- **æ–°å¢æ•ˆæœ**: 8 å€‹
- **ç¸½è¨ˆæ•ˆæœ**: 12 å€‹

### ä¸»è¦æ”¹é€²
âœ… **é¡è‰²å‹•æ…‹è®ŠåŒ–**: 4 å€‹æ–°æ•ˆæœå¯æ ¹æ“šéŸ³è¨Šé »ç‡å‹•æ…‹æ”¹è®Šé¡è‰²ï¼Œè€Œä¸åªæ˜¯äº®åº¦
âœ… **ç²’å­ç³»çµ±**: 4 å€‹æ–°æ•ˆæœæ¡ç”¨ç²’å­/å‹•æ…‹ç³»çµ±
âœ… **åƒè€ƒ WLED**: åŸºæ–¼å°ˆæ¥­çš„ WLED Audio Reactive å°ˆæ¡ˆæ”¹é€²
âœ… **å®Œæ•´æ–‡æª”**: åŒ…å«è©³ç´°æŒ‡å—å’Œå¿«é€Ÿåƒè€ƒ

---

## ğŸ¨ æ–°å¢æ•ˆæœè©³ç´°åˆ—è¡¨

### 1. é¡è‰²å‹•æ…‹è®ŠåŒ–æ•ˆæœ

#### frequency_wave (é »ç‡æ³¢å‹•)
```python
def _effect_frequency_wave(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Freqwave
- **é¡è‰²æ©Ÿåˆ¶**: `hue = f(fft_major_peak)` - 80Hz åˆ° 8000Hz æ˜ å°„åˆ°è‰²ç›¸ 0-280Â°
- **è¦–è¦ºæ•ˆæœ**: å¾ä¸­å¿ƒå‘å¤–æµå‹•çš„é »ç‡è‰²å½©æ³¢æµª
- **æŠ€è¡“ç‰¹é»**: ä½¿ç”¨å°æ•¸é »ç‡æ˜ å°„ `log10(freq)`
- **é©ç”¨å ´æ™¯**: æ‰€æœ‰éŸ³æ¨‚é¡å‹ï¼Œå±•ç¤ºé »ç‡è®ŠåŒ–

#### color_wave (é¡è‰²æ³¢å‹•)
```python
def _effect_color_wave(self):
```
- **é¡è‰²æ©Ÿåˆ¶**: `hue = f(bass, mids, highs)` - é »ç‡çµ„æˆçš„åŠ æ¬Šæ··åˆ
  - Bass (0-5 bins): 30Â° (ç´…/æ©™)
  - Mids (5-11 bins): 150Â° (ç¶ /é’)
  - Highs (11-16 bins): 260Â° (è—/ç´«)
- **è¦–è¦ºæ•ˆæœ**: æ•´æ¢ç‡ˆå¸¶æ³¢æµªå¼é¡è‰²è®ŠåŒ–
- **æŠ€è¡“ç‰¹é»**: å¹³æ»‘è‰²ç›¸éæ¸¡ (90% èˆŠå€¼ + 10% æ–°å€¼)
- **é©ç”¨å ´æ™¯**: é›»å­éŸ³æ¨‚ã€EDMã€æ²‰æµ¸å¼é«”é©—

#### beat_pulse (ç¯€æ‹è„ˆè¡)
```python
def _effect_beat_pulse(self):
```
- **éˆæ„Ÿä¾†æº**: åŸå‰µè¨­è¨ˆ
- **é¡è‰²æ©Ÿåˆ¶**: ç¯€æ‹æª¢æ¸¬æ™‚è‰²ç›¸å¢åŠ  30Â°
- **è¦–è¦ºæ•ˆæœ**: å…¨ç‡ˆæ¢è„ˆè¡ + ç¯€æ‹é–ƒå…‰
- **æŠ€è¡“ç‰¹é»**: ä½¿ç”¨ `sample_peak` é€²è¡Œç¯€æ‹æª¢æ¸¬
- **é©ç”¨å ´æ™¯**: ç¯€å¥æ¸…æ™°çš„éŸ³æ¨‚ã€æ´¾å°

#### waterfall (ç€‘å¸ƒ)
```python
def _effect_waterfall(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Freqmatrix
- **é¡è‰²æ©Ÿåˆ¶**: ä¸»è¦ FFT bin æ±ºå®šè‰²ç›¸
- **è¦–è¦ºæ•ˆæœ**: é »è­œé¡è‰²å¾ä¸Šå¾€ä¸‹ç€‘å¸ƒæµå‹•
- **æŠ€è¡“ç‰¹é»**: åƒç´ é€è¡Œä¸‹ç§»ï¼Œé ‚éƒ¨æ·»åŠ æ–°æ•¸æ“š
- **é©ç”¨å ´æ™¯**: è§€å¯ŸéŸ³æ¨‚é »ç‡çš„æ™‚é–“è®ŠåŒ–

### 2. ç²’å­/å‹•æ…‹æ•ˆæœ

#### blurz (æ¨¡ç³Šå…‰é»)
```python
def _effect_blurz(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Blurz
- **å·¥ä½œåŸç†**: æ¯å€‹ FFT bin åœ¨å°æ‡‰ä½ç½®å‰µå»ºå½©è‰²å…‰é»
- **è¦–è¦ºæ•ˆæœ**: é–¾å€¼è§¸ç™¼çš„å½©è‰²å…‰é» + æ‹–å°¾æ·¡å‡º
- **æŠ€è¡“ç‰¹é»**: 85% æ·¡å‡ºï¼Œé–¾å€¼ 100/255
- **é©ç”¨å ´æ™¯**: å¿«ç¯€å¥éŸ³æ¨‚ï¼Œé¡¯ç¤ºé »ç‡æ´»å‹•

#### pixels (åƒç´ æ•£å°„)
```python
def _effect_pixels(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Pixels
- **å·¥ä½œåŸç†**: éŸ³é‡æ±ºå®šéš¨æ©Ÿåƒç´ æ•¸é‡ï¼ŒéŸ³é‡æ­·å²æ±ºå®šé¡è‰²
- **è¦–è¦ºæ•ˆæœ**: æ˜Ÿç©ºèˆ¬çš„éš¨æ©Ÿé–ƒçˆ
- **æŠ€è¡“ç‰¹é»**: ä½¿ç”¨ `deque` å„²å­˜éŸ³é‡æ­·å² (maxlen=32)
- **é©ç”¨å ´æ™¯**: ç¯€å¥è±å¯Œçš„éŸ³æ¨‚

#### puddles (æ°´å‘)
```python
def _effect_puddles(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Puddles
- **å·¥ä½œåŸç†**: éŸ³é‡è¶…éé–¾å€¼æ™‚éš¨æ©Ÿä½ç½®å‰µå»ºå…‰é»çµ„
- **è¦–è¦ºæ•ˆæœ**: éš¨æ©Ÿå½©è‰²"æ°´å‘"æ•ˆæœ
- **æŠ€è¡“ç‰¹é»**: 88% æ·¡å‡ºï¼Œé–¾å€¼ 50/255
- **é©ç”¨å ´æ™¯**: æ‰“æ“Šæ¨‚å™¨ç‚ºä¸»çš„éŸ³æ¨‚

#### ripple (æ¼£æ¼ª)
```python
def _effect_ripple(self):
```
- **éˆæ„Ÿä¾†æº**: WLED Ripple/Ripplepeak
- **å·¥ä½œåŸç†**: ç¯€æ‹æª¢æ¸¬æ™‚å¾ä¸­å¿ƒå‰µå»ºå‘å¤–æ“´æ•£çš„æ³¢ç´‹
- **è¦–è¦ºæ•ˆæœ**: åŒå¿ƒåœ“æ“´æ•£çš„å½©è‰²æ³¢ç´‹
- **æŠ€è¡“ç‰¹é»**: å‹•æ…‹æ³¢ç´‹åˆ—è¡¨ï¼Œè‡ªå‹•æ¸…ç†å®Œæˆçš„æ³¢ç´‹
- **é©ç”¨å ´æ™¯**: ç¯€æ‹æ¸…æ™°çš„éŸ³æ¨‚ï¼Œè¦–è¦ºè¡æ“ŠåŠ›å¼·

---

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### ä»£ç¢¼çµæ§‹æ”¹é€²

#### 1. æ–°å¢ç‹€æ…‹ç®¡ç†
```python
self.effect_state = {
    'time': 0,                          # æ™‚é–“è¨ˆæ•¸å™¨
    'hue_offset': 0,                    # è‰²ç›¸åç§»
    'pixel_history': deque(maxlen=32),  # åƒç´ æ­·å²
    'ripple_positions': [],             # æ³¢ç´‹ä½ç½®åˆ—è¡¨
}
```

#### 2. æ–°å¢éŸ³è¨Šæ•¸æ“šæ¬„ä½
```python
self.fft_major_peak = 120.0  # ä¸»è¦é »ç‡å³°å€¼ (Hz)
self.fft_magnitude = 0.0      # FFT å¹…åº¦
```

#### 3. æ•ˆæœæ›´æ–°å¾ªç’°
```python
def _update_leds(self):
    self.effect_state['time'] += 1  # æ™‚é–“éå¢

    if self.current_effect == "frequency_wave":
        self._effect_frequency_wave()
    # ... å…¶ä»–æ•ˆæœ
```

### é¡è‰²è¨ˆç®—æ–¹æ³•

#### HSV to RGB è½‰æ›
```python
@staticmethod
def _hsv_to_rgb(h, s, v):
    """
    h: 0-360 (è‰²ç›¸)
    s: 0-1 (é£½å’Œåº¦)
    v: 0-1 (æ˜åº¦/äº®åº¦)
    è¿”å›: (r, g, b) 0-255
    """
```

#### é »ç‡åˆ°è‰²ç›¸æ˜ å°„
```python
# å°æ•¸æ˜ å°„ (frequency_wave)
hue = (log10(freq) - log10(80)) / (log10(8000) - log10(80)) * 280

# åŠ æ¬Šæ··åˆ (color_wave)
hue = (bass * 30 + mids * 150 + highs * 260) / total
```

### æ·¡å‡º/æ‹–å°¾æ•ˆæœå¯¦ä½œ
```python
# å¾ GRB æ•´æ•¸æå– RGB
r = (color >> 16) & 0xFF
g = (color >> 8) & 0xFF
b = color & 0xFF

# æ·¡å‡ºåˆ° X%
r = int(r * fade_factor)
g = int(g * fade_factor)
b = int(b * fade_factor)

# é‡çµ„ç‚º GRB Color
self.strip.setPixelColor(i, Color(g, r, b))
```

---

## ğŸ“š æ–‡æª”æ›´æ–°

### æ–°å¢æ–‡æª”æª”æ¡ˆ

#### 1. EFFECTS_GUIDE.md
- **å…§å®¹**: å®Œæ•´çš„æ•ˆæœèªªæ˜æ–‡æª”
- **ç« ç¯€**:
  - åŸæœ‰æ•ˆæœè©³è§£
  - æ–°å¢æ•ˆæœè©³è§£
  - ä½¿ç”¨æ–¹æ³•
  - æ•ˆæœæ¯”è¼ƒè¡¨
  - æ¨è–¦é…ç½®
  - æŠ€è¡“ç´°ç¯€

#### 2. EFFECTS_QUICK_REF.md
- **å…§å®¹**: å¿«é€Ÿåƒè€ƒå¡ç‰‡
- **ç‰¹é»**:
  - æ¯å€‹æ•ˆæœçš„å‘½ä»¤ç¯„ä¾‹
  - å¿«é€Ÿæ¸¬è©¦æŒ‡ä»¤
  - å¸¸è¦‹å•é¡Œè§£ç­”

#### 3. test_effects.sh
- **åŠŸèƒ½**: è‡ªå‹•æ¸¬è©¦æ‰€æœ‰ 12 å€‹æ•ˆæœ
- **ç‰¹é»**:
  - æ¯å€‹æ•ˆæœé‹è¡Œ 10 ç§’
  - ä½¿ç”¨æ¨¡æ“¬å™¨å®‰å…¨æ¸¬è©¦
  - è‡ªå‹•å¾ªç’°æ‰€æœ‰æ•ˆæœ

#### 4. README_INTEGRATED.md (æ›´æ–°)
- **æ›´æ–°å…§å®¹**:
  - æ•ˆæœåˆ—è¡¨æ“´å……åˆ° 12 å€‹
  - æ–°å¢æ•ˆæœä½¿ç”¨å ´æ™¯
  - æ•ˆæœåƒæ•¸å°ç…§è¡¨

---

## ğŸ¯ æ•ˆæœæ¨è–¦é…ç½®

### æŒ‰éŸ³æ¨‚é¡å‹

| éŸ³æ¨‚é¡å‹ | æ¨è–¦æ•ˆæœ | æ›¿ä»£æ•ˆæœ |
|---------|---------|---------|
| é›»å­/EDM | `color_wave` | `pixels`, `blurz` |
| æ–æ»¾/æµè¡Œ | `beat_pulse` | `ripple` |
| å¤å…¸/çˆµå£« | `frequency_wave` | `waterfall` |
| å˜»å“ˆ/ç¯€å¥è—èª¿ | `beat_pulse` | `puddles` |
| ç’°å¢ƒ/æ°›åœ | `rainbow_spectrum` | `frequency_wave` |
| æ´¾å°/DJ | `ripple` | `pixels`, `beat_pulse` |

### æŒ‰å ´åˆ

| å ´åˆ | æ¨è–¦æ•ˆæœ | èªªæ˜ |
|-----|---------|------|
| å®¶åº­èšæœƒ | `rainbow_spectrum` | è‰²å½©è±å¯Œä½†ä¸éæ–¼åˆºæ¿€ |
| ç¾å ´è¡¨æ¼” | `beat_pulse` | è¦–è¦ºè¡æ“ŠåŠ›å¼· |
| é…’å§/å¤œåº— | `color_wave` | æ²‰æµ¸å¼é«”é©— |
| æŠ€è¡“å±•ç¤º | `spectrum_bars` | å±•ç¤ºé »è­œåˆ†æ |
| æ¸¬è©¦/é–‹ç™¼ | `vu_meter` | ç°¡å–®ç›´è§€ |

---

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### 1. å¿«é€Ÿæ¸¬è©¦å–®ä¸€æ•ˆæœ
```bash
python3 audio_reactive_integrated.py --emulator --effect frequency_wave
```

### 2. æ¸¬è©¦æ‰€æœ‰æ•ˆæœ
```bash
./test_effects.sh
```

### 3. é…åˆ EQ Streamer æ¸¬è©¦
```bash
# Terminal 1
python3 audio_reactive_integrated.py --emulator --effect color_wave

# Terminal 2 (Windows)
cd LQS-IoT_EqStreamer
dotnet run <raspberry_pi_ip>
```

### 4. æ•ˆæœæ¯”è¼ƒ
```bash
# é–‹å•Ÿå¤šå€‹çµ‚ç«¯ï¼ŒåŒæ™‚é‹è¡Œä¸åŒæ•ˆæœ
python3 audio_reactive_integrated.py --emulator --effect frequency_wave --display horizontal
python3 audio_reactive_integrated.py --emulator --effect color_wave --display vertical
```

---

## ğŸ“ˆ æ€§èƒ½è€ƒé‡

### CPU ä½¿ç”¨ç‡
- **åŸæœ‰æ•ˆæœ**: ä½åˆ°ä¸­ç­‰ï¼ˆä¸»è¦æ˜¯ FFT æ•¸æ“šè®€å–ï¼‰
- **æ–°å¢æ•ˆæœ**: ä¸­ç­‰ï¼ˆé¡å¤–çš„æ•¸å­¸è¨ˆç®—å’Œç‹€æ…‹ç®¡ç†ï¼‰
- **æœ€è€—è³‡æº**: `ripple`ï¼ˆå‹•æ…‹åˆ—è¡¨ç®¡ç†ï¼‰ã€`pixels`ï¼ˆéš¨æ©Ÿæ•¸ç”Ÿæˆï¼‰

### è¨˜æ†¶é«”ä½¿ç”¨
- **effect_state**: ç´„ 1-2 KB
- **pixel_history**: 32 bytes (deque)
- **ripple_positions**: å‹•æ…‹ï¼Œé€šå¸¸ < 1 KB

### å„ªåŒ–å»ºè­°
1. **é™ä½æ›´æ–°ç‡**: å¦‚æœ CPU ä¸è¶³ï¼Œåœ¨ `_process_loop` ä¸­å¢åŠ  `time.sleep()`
2. **æ¸›å°‘ LED æ•¸é‡**: ä½¿ç”¨ `--num-leds` åƒæ•¸
3. **é¸æ“‡è¼ƒç°¡å–®çš„æ•ˆæœ**: å¦‚ `spectrum_bars` æˆ– `vu_meter`

---

## ğŸ”® æœªä¾†æ”¹é€²æ–¹å‘

### åŠŸèƒ½æ“´å……
- [ ] æ•ˆæœåƒæ•¸å¯èª¿ï¼ˆé€Ÿåº¦ã€éˆæ•åº¦ã€é¡è‰²ç¯„åœï¼‰
- [ ] æ•ˆæœçµ„åˆ/æ··åˆæ¨¡å¼
- [ ] è‡ªå®šç¾©é¡è‰²ä¸»é¡Œ
- [ ] æ•ˆæœé–“å¹³æ»‘éæ¸¡å‹•ç•«

### äº’å‹•åŠŸèƒ½
- [ ] Web UI æ§åˆ¶ä»‹é¢
- [ ] MQTT æ§åˆ¶æ”¯æ´
- [ ] é è¨­å ´æ™¯å„²å­˜/è¼‰å…¥
- [ ] å³æ™‚æ•ˆæœåˆ‡æ›ï¼ˆä¸é‡å•Ÿï¼‰

### éŸ³è¨Šè™•ç†
- [ ] æ›´ç²¾ç¢ºçš„ç¯€æ‹æª¢æ¸¬ç®—æ³•
- [ ] éŸ³èª¿è­˜åˆ¥ï¼ˆå’Œå¼¦æª¢æ¸¬ï¼‰
- [ ] å‹•æ…‹ AGC èª¿æ•´
- [ ] å¤šé »æ®µå£“ç¸®å™¨

---

## ğŸ“ å­¸ç¿’è³‡æº

### åƒè€ƒå°ˆæ¡ˆ
1. **WLED Audio Reactive**
   - GitHub: https://github.com/Aircoookie/WLED
   - æ•ˆæœå¯¦ä½œ: `wled00/FX.cpp`
   - éŸ³è¨Šè™•ç†: `usermods/audioreactive/`

2. **SR-WLED**
   - GitHub: https://github.com/atuline/WLED
   - Wiki: è©³ç´°çš„éŸ³è¨Šåæ‡‰æ•ˆæœèªªæ˜

### ç›¸é—œæŠ€è¡“
- **FFT (å¿«é€Ÿå‚…ç«‹è‘‰è®Šæ›)**: éŸ³è¨Šé »è­œåˆ†æåŸºç¤
- **HSV è‰²å½©ç©ºé–“**: æ›´é©åˆå‹•æ…‹é¡è‰²è®ŠåŒ–
- **ç¯€æ‹æª¢æ¸¬**: åŸºæ–¼èƒ½é‡å·®å’Œé–¾å€¼
- **ç²’å­ç³»çµ±**: å‹•æ…‹è¦–è¦ºæ•ˆæœçš„åŸºç¤

---

## ğŸ“ æ”¯æ´èˆ‡åé¥‹

### å•é¡Œå›å ±
å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š
- ä½¿ç”¨çš„æ•ˆæœåç¨±
- éŸ³è¨Šä¾†æºï¼ˆEQ Streamer / WLEDï¼‰
- éŒ¯èª¤è¨Šæ¯æˆ–ç•°å¸¸è¡Œç‚º
- LED æ•¸é‡å’Œç¡¬é«”é…ç½®

### æ•ˆæœå»ºè­°
æ­¡è¿æå‡ºæ–°æ•ˆæœçš„æƒ³æ³•æˆ–æ”¹é€²å»ºè­°ï¼

---

## âœ… é©—æ”¶æª¢æŸ¥æ¸…å–®

- [x] 8 å€‹æ–°æ•ˆæœå…¨éƒ¨å¯¦ä½œå®Œæˆ
- [x] æ‰€æœ‰æ•ˆæœé€šéåŸºæœ¬æ¸¬è©¦
- [x] æ•ˆæœåˆ‡æ›åŠŸèƒ½æ­£å¸¸
- [x] å‘½ä»¤è¡Œåƒæ•¸æ›´æ–°
- [x] æ•ˆæœåˆ—è¡¨æ›´æ–°
- [x] å®Œæ•´æ–‡æª”æ’°å¯«
- [x] å¿«é€Ÿåƒè€ƒå‰µå»º
- [x] æ¸¬è©¦è…³æœ¬å‰µå»º
- [x] README æ›´æ–°
- [x] ç¨‹å¼ç¢¼è¨»è§£ï¼ˆè‹±æ–‡ï¼‰
- [x] ç„¡èªæ³•éŒ¯èª¤

## ğŸ‰ ç¸½çµ

æ­¤æ¬¡æ›´æ–°å¤§å¹…æ“´å……äº† LED éŸ³è¨Šåæ‡‰æ•ˆæœçš„åŠŸèƒ½ï¼Œç‰¹åˆ¥æ˜¯ï¼š

1. **é¡è‰²å‹•æ…‹åŒ–**: å¾å›ºå®šé¡è‰²+äº®åº¦è®ŠåŒ–ï¼Œé€²åŒ–ç‚ºé¡è‰²æœ¬èº«éš¨éŸ³è¨Šè®ŠåŒ–
2. **æ•ˆæœå¤šæ¨£åŒ–**: å¾ 4 å€‹åŸºç¤æ•ˆæœæ“´å……åˆ° 12 å€‹å°ˆæ¥­æ•ˆæœ
3. **åƒè€ƒå°ˆæ¥­å°ˆæ¡ˆ**: åŸºæ–¼ WLED çš„æˆç†Ÿå¯¦ä½œé€²è¡Œæ”¹é€²
4. **å®Œæ•´æ–‡æª”**: æä¾›è©³ç›¡çš„ä½¿ç”¨æŒ‡å—å’ŒæŠ€è¡“æ–‡æª”

ä½¿ç”¨è€…ç¾åœ¨å¯ä»¥æ ¹æ“šä¸åŒçš„éŸ³æ¨‚é¡å‹å’Œå ´åˆï¼Œé¸æ“‡æœ€é©åˆçš„è¦–è¦ºæ•ˆæœï¼Œå‰µé€ æ›´è±å¯Œçš„éŸ³æ¨‚è¦–è¦ºé«”é©—ï¼
