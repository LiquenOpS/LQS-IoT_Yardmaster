# 🎯 居中效果設計

## 概述

`vu_meter` 和 `spectrum_bars` 效果現在使用**居中鏡像**設計，從 LED 條的中心向兩側擴展，創造更對稱、更吸引人的視覺效果。

---

## 🎨 居中效果列表

### 1. VU Meter（音量計）

**設計原理**：
- 音量從中心向兩側擴展
- 音量越大，點亮的 LED 越多（向兩側延伸）
- 創造"能量從中心爆發"的視覺感受

**顏色漸變**：
```
左邊緣 ←────── 中心 ──────→ 右邊緣
 粉紅色         藍色         粉紅色
 (320°)        (260°)        (320°)
```

**視覺效果**：
```
音量 0%:    ───────●───────  (只有中心點亮)
音量 30%:   ────●●●●●────  (中心附近)
音量 60%:   ──●●●●●●●●●──  (擴展到兩側)
音量 100%:  ●●●●●●●●●●●●●  (全亮)
```

**特點**：
- 中心顏色：藍色/紫色（260°）
- 邊緣顏色：粉紅色（320°）
- 平滑漸變過渡
- 音量響應曲線：使用 `volume^0.3` 讓低音量也能有明顯反應

---

### 2. Spectrum Bars（頻譜條）

**設計原理**：
- 頻譜從中心向兩側鏡像顯示
- 中心顯示低頻（bass）
- 邊緣顯示高頻（treble）
- 左右完全對稱

**頻率分布**：
```
左邊緣 ←────────── 中心 ──────────→ 右邊緣
高頻(藍)  中頻(紫)  低頻(粉)  中頻(紫)  高頻(藍)
Treble    Mids     Bass     Mids    Treble
200°      280°     320°     280°    200°
```

**視覺效果**：
```
Bass 音樂:   ───────●●●───────  (中心跳動)
Mids 音樂:   ────●●●●●●●────  (中間區域)
Treble 音樂: ●●●────────●●●  (邊緣閃爍)
全頻譜:      ●●●●●●●●●●●●●  (全部點亮)
```

**顏色映射**：
- **中心區域**（Bass，0-4 bins）：粉紅色 (320°)
- **中間區域**（Mids，5-10 bins）：紫色 (280°)
- **邊緣區域**（Highs，11+ bins）：藍色 (200°)

**特點**：
- 完美的左右鏡像對稱
- 頻率分離明顯
- 低音在中心"跳動"
- 高音在邊緣"閃爍"

---

## 📊 居中 vs 非居中對比

### 傳統設計（從左到右）
```
[低音] [中音] [高音] ──→
●●●●●●●●●●●●●
```
- ✅ 簡單直觀
- ❌ 視覺不平衡
- ❌ 缺少焦點

### 居中設計（從中心向外）
```
    [中心：低音]
[高音] ←─●─→ [高音]
●●●●●●●●●●●●●
```
- ✅ 視覺平衡
- ✅ 中心焦點明確
- ✅ 更吸引人
- ✅ 對稱美感

---

## 🎵 使用場景

### VU Meter 居中
**最適合**：
- 🎤 人聲為主的音樂
- 🎹 整體音量變化明顯的音樂
- 💫 需要強烈視覺衝擊的場合
- 🎪 派對、活動展示

**視覺特徵**：
- 低音量時：中心微弱發光
- 中音量時：能量向兩側擴散
- 高音量時：整條 LED 爆發

### Spectrum Bars 居中
**最適合**：
- 🎸 電子音樂（EDM、Dubstep）
- 🥁 打擊樂為主的音樂
- 🎼 複雜的音樂編排
- 🎨 需要頻率分離展示的場合

**視覺特徵**：
- Bass Drop：中心強烈跳動
- 高音旋律：邊緣閃爍
- 全頻音樂：整體律動

---

## 🔧 技術細節

### VU Meter 實現

```python
def _effect_vu_meter(self):
    volume = self.sample_agc
    center = self.num_leds // 2

    # 使用 volume^0.3 增加靈敏度
    lit_half = int(((volume / 255.0) ** 0.3) * center)

    for i in range(self.num_leds):
        distance_from_center = abs(i - center)

        if distance_from_center < lit_half:
            # 基於距離的顏色漸變
            ratio = distance_from_center / max(center, 1)
            hue = 260 + (ratio * 60)  # 260° -> 320°
            brightness = 1.0 - ratio * 0.2
            saturation = 0.7 + ratio * 0.3
```

**關鍵參數**：
- `volume ** 0.3`：增加低音量靈敏度
- `hue = 260 + (ratio * 60)`：中心藍紫 → 邊緣粉紅
- `brightness = 1.0 - ratio * 0.2`：中心更亮，邊緣稍暗

### Spectrum Bars 實現

```python
def _effect_spectrum_bars(self):
    fft = self.fft_result
    center = self.num_leds // 2

    for i in range(self.num_leds):
        # 計算到中心的距離
        distance_from_center = abs(i - center)

        # 映射到 FFT bins（中心=低頻，邊緣=高頻）
        bin_idx = int(distance_from_center * FFT_BINS / center)

        # 根據頻段選擇顏色
        if bin_idx < 5:    hue = 320  # Bass - Pink
        elif bin_idx < 11: hue = 280  # Mids - Purple
        else:              hue = 200  # Highs - Blue
```

**關鍵邏輯**：
- `distance_from_center = abs(i - center)`：計算對稱距離
- `bin_idx = distance * FFT_BINS / center`：映射到頻率
- 左右兩側相同距離 = 相同頻率 = 鏡像效果

---

## 🎨 配色方案

兩個效果都使用相同的夢幻色系：

| 位置 | 頻率/用途 | 色相 | 顏色 | RGB 參考 |
|-----|----------|------|------|---------|
| **中心** | Bass / 低音量 | 260° | 藍紫色 | (100, 100, 255) |
| **中間** | Mids / 中音量 | 280° | 紫色 | (180, 100, 255) |
| **邊緣** | Highs / 高音量 | 320° | 粉紅色 | (255, 100, 180) |

**飽和度**：0.7-1.0（柔和粉嫩效果）
**亮度**：根據音訊強度動態調整

---

## 💡 調優建議

### 調整 VU Meter 靈敏度

```python
# 更靈敏（小音量也有大反應）
lit_half = int(((volume / 255.0) ** 0.2) * center)

# 預設（平衡）
lit_half = int(((volume / 255.0) ** 0.3) * center)

# 更不靈敏（需要較大音量才有反應）
lit_half = int(((volume / 255.0) ** 0.5) * center)
```

### 調整顏色漸變範圍

```python
# VU Meter
# 更大的色相變化（更鮮明對比）
hue = 260 + (ratio * 80)  # 260° -> 340°

# 預設
hue = 260 + (ratio * 60)  # 260° -> 320°

# 更小的色相變化（更柔和）
hue = 260 + (ratio * 40)  # 260° -> 300°
```

### 調整頻率映射

```python
# Spectrum Bars
# 更重視低頻（中心區域更大）
if bin_idx < 8:    hue = 320  # Bass (擴大範圍)
elif bin_idx < 13: hue = 280  # Mids
else:              hue = 200  # Highs

# 預設（平衡）
if bin_idx < 5:    hue = 320  # Bass
elif bin_idx < 11: hue = 280  # Mids
else:              hue = 200  # Highs

# 更重視高頻（邊緣區域更大）
if bin_idx < 3:    hue = 320  # Bass (縮小範圍)
elif bin_idx < 8:  hue = 280  # Mids
else:              hue = 200  # Highs
```

---

## 🎯 設計哲學

### 為什麼居中？

1. **視覺平衡**
   - 人眼更喜歡對稱的設計
   - 創造自然的焦點（中心）

2. **能量感**
   - 從中心"爆發"的感覺更有力量
   - 符合"聲音從一個點擴散"的直覺

3. **空間利用**
   - 充分利用整個 LED 條的長度
   - 左右鏡像避免浪費

4. **美學原則**
   - 對稱 = 和諧
   - 中心焦點 = 清晰
   - 漸變過渡 = 柔和

---

## 📚 相關效果

### 其他可能適合居中的效果

1. **ripple**（漣漪）
   - 已經是居中的！
   - 波紋從中心向外擴散

2. **beat_pulse**（節拍脈衝）
   - 可以考慮改為居中爆發
   - 當前是全條閃爍

3. **blurz**（模糊）
   - 可以考慮從中心開始漂移
   - 增加對稱性

### 不適合居中的效果

1. **waterfall**（瀑布）
   - 需要單向流動
   - 居中會失去"瀑布"的感覺

2. **frequency_wave**（頻率波）
   - 已經有從中心向外的擴散邏輯
   - 不需要鏡像

---

## 🎊 總結

居中設計為 `vu_meter` 和 `spectrum_bars` 帶來：

✨ **視覺提升**：
- 更平衡的畫面
- 更強的焦點
- 更美的對稱

🎵 **音訊表現**：
- 清晰的頻率分離（spectrum）
- 直觀的音量顯示（vu_meter）
- 更好的音樂律動感

🎨 **美學價值**：
- 夢幻的粉紅/紫色/藍色配色
- 柔和的漸變過渡
- 專業的視覺效果

享受你的居中、對稱、夢幻的 LED 效果！✨🎵
